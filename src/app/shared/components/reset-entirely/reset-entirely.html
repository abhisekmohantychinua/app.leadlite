<!-- Danger trigger replicates GitHub-style confirmation for destructive flows. -->
<button
  pButton
  type="button"
  severity="danger"
  class="reset-entirely__trigger"
  (click)="openDialog()">
  <span pButtonLabel>Reset Entirely</span>
</button>

<p-toast position="top-center"></p-toast>

<!-- Modal cannot be dismissed outside of confirm/cancel interactions. -->
<p-dialog
  header="Reset Everything"
  [visible]="dialogVisible()"
  [modal]="true"
  [closable]="false"
  [dismissableMask]="false"
  [closeOnEscape]="false"
  [draggable]="false"
  [resizable]="false"
  style="width: min(90vw, 480px)">
  <div class="reset-entirely__dialog">
    <p class="reset-entirely__copy">
      This action will reset all the data stored or used by this application entirely. You might not
      revert them back.
    </p>

    <label class="reset-entirely__label" for="reset-confirmation">
      Type "{{ confirmationPhrase }}" to confirm your action.
    </label>

    <input
      pInputText
      id="reset-confirmation"
      type="text"
      [value]="confirmationValue()"
      (input)="handleInput($any($event.target).value)"
      autocomplete="off"
      spellcheck="false"
      placeholder="reset-entirely"
      [disabled]="isConfirming()" />

    @if (dialogError()) {
      <p-message
        data-testid="reset-error"
        severity="error"
        variant="simple"
        size="small"
        aria-live="assertive">
        {{ dialogError() }}
      </p-message>
    }

    @if (isConfirming()) {
      <div class="reset-entirely__loader" aria-live="polite">
        <p-progressSpinner styleClass="reset-entirely__spinner"></p-progressSpinner>
        <span>Resetting everything...</span>
      </div>
    }

    <div class="reset-entirely__actions">
      <button
        pButton
        type="button"
        severity="secondary"
        (click)="cancel()"
        [disabled]="isConfirming()">
        <span pButtonLabel>Cancel</span>
      </button>
      <button
        pButton
        type="button"
        severity="danger"
        data-testid="reset-confirm"
        (click)="confirmReset()"
        [disabled]="!canConfirm() || isConfirming()">
        <span pButtonLabel>Confirm Reset</span>
      </button>
    </div>
  </div>
</p-dialog>
