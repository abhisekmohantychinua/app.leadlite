import{a as w,b as Xe,c as qe,d as We,e as Je,h as Ze}from"./chunk-YQ6OXZUK.js";import{a as Qe,b as Ke}from"./chunk-5QNSYKLY.js";import{b as q,c as I,e as A,f as Re,h as Ve,i as je,k as He,l as Oe,m as ze,n as Ye,o as Ge,q as Q,r as K,s as W,t as Ae}from"./chunk-TV2VNHIC.js";import{a as Ee,b as Ue}from"./chunk-M3EKECSN.js";import{e as De,k as Ie,l as Ne,m as Te,n as Fe,o as ke,q as Pe,r as Be}from"./chunk-ZL67F5YZ.js";import{Ba as G,Da as X,g as Le,h as Ce,i as z,p as Me,r as xe,xa as Y}from"./chunk-DBNTJJ5Q.js";import{$a as B,$b as re,Bc as O,Db as U,Hb as s,Ib as D,Jb as R,Kb as V,M as ce,Na as d,Qb as he,Rb as ge,S as F,Sb as ve,T as k,Wb as j,X as h,Xb as p,Yb as be,Za as m,Zb as b,_a as P,_b as ae,aa as L,ac as oe,ba as C,bb as E,bc as H,dc as ye,gc as de,ic as _e,ja as _,jc as Se,ma as S,ob as M,pb as x,qb as ue,qc as y,rb as me,sb as fe,tb as c,tc as f,ub as r,uc as g,vb as o,vc as we,wb as u}from"./chunk-QDV7XRN5.js";var dt=["addLeadPopover"];function lt(t,n){t&1&&p(0," Lead name is required. ")}function st(t,n){t&1&&p(0," Minimum 3 characters. ")}function pt(t,n){t&1&&p(0," Maximum 100 characters. ")}function ct(t,n){if(t&1&&(r(0,"p-message",8),M(1,lt,1,0)(2,st,1,0)(3,pt,1,0),o()),t&2){let i,e=D();d(),x(!((i=e.newLeadForm.get("lead"))==null||i.errors==null)&&i.errors.required?1:!((i=e.newLeadForm.get("lead"))==null||i.errors==null)&&i.errors.minlength?2:!((i=e.newLeadForm.get("lead"))==null||i.errors==null)&&i.errors.maxlength?3:-1)}}function ut(t,n){t&1&&(r(0,"p-message",9),p(1," Enter the name of the lead. "),o())}function mt(t,n){t&1&&p(0," Value must be at least 0. ")}function ft(t,n){if(t&1&&(r(0,"p-message",8),M(1,mt,1,0),o()),t&2){let i,e=D();d(),x(!((i=e.newLeadForm.get("value"))==null||i.errors==null)&&i.errors.min?1:-1)}}function ht(t,n){t&1&&(r(0,"p-message",9),p(1," Enter the estimated value of the lead. "),o())}var J=class t{leadService=h(w);fb=h(ze);addLeadPopover=we.required("addLeadPopover");createLeadSubscription;newLeadForm=this.fb.group({lead:this.fb.nonNullable.control("",{validators:[I.required,I.minLength(8),I.maxLength(100)]}),value:this.fb.control(null,{validators:[I.min(0)]})});formSubmitted=_(!1);loading=_(!1);createdNewLead=f();isInvalid(n){let i=this.newLeadForm.get(n);return!!(i&&i.invalid&&(i.touched||this.formSubmitted()))}handleSubmit(){if(this.formSubmitted.set(!0),this.newLeadForm.invalid)return;this.loading.set(!0);let{lead:n,value:i}=this.newLeadForm.getRawValue(),e={title:n,value:i??void 0};this.createLeadSubscription=this.leadService.createLead(e).subscribe({next:a=>{this.resetForm(),this.createdNewLead.emit(a),this.addLeadPopover().hide()},error:a=>{console.error("Error creating lead:",a),this.loading.set(!1)},complete:()=>{this.loading.set(!1)}})}resetForm(){this.newLeadForm.reset({lead:"",value:null}),this.formSubmitted.set(!1),this.loading.set(!1)}ngOnDestroy(){this.createLeadSubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=m({type:t,selectors:[["app-new-lead"]],viewQuery:function(i,e){i&1&&he(e.addLeadPopover,dt,5),i&2&&ge()},outputs:{createdNewLead:"createdNewLead"},decls:20,vars:8,consts:[["addLeadPopover",""],["pButton","",3,"click"],["pButtonIcon","",1,"pi","pi-plus"],["pButtonLabel",""],[1,"flex","flex-col","gap-4","w-xs",3,"ngSubmit","formGroup"],[1,"flex","flex-col","gap-2"],["for","lead"],["pInputText","","id","lead","aria-describedby","lead-help","formControlName","lead",3,"pAutoFocus","ariaInvalid"],["severity","error","size","small","variant","simple"],["severity","secondary","size","small","variant","simple"],["for","value"],["mode","currency","currency","INR","currencyDisplay","symbol","locale","en-IN","id","value","aria-describedby","value-help","formControlName","value",3,"invalid"],["type","submit","label","Create",3,"loading","disabled"]],template:function(i,e){if(i&1){let a=U();r(0,"button",1),s("click",function(N){L(a);let T=ve(5);return C(T.toggle(N))}),u(1,"i",2),r(2,"span",3),p(3,"New Lead"),o()(),r(4,"p-popover",null,0)(6,"form",4),s("ngSubmit",function(){return L(a),C(e.handleSubmit())}),r(7,"div",5)(8,"label",6),p(9,"Lead"),o(),u(10,"input",7),M(11,ct,4,1,"p-message",8)(12,ut,2,0,"p-message",9),o(),r(13,"div",5)(14,"label",10),p(15,"Value"),o(),u(16,"p-inputnumber",11),M(17,ft,2,1,"p-message",8)(18,ht,2,0,"p-message",9),o(),u(19,"p-button",12),o()()}i&2&&(d(6),c("formGroup",e.newLeadForm),d(4),c("pAutoFocus",!0)("ariaInvalid",e.isInvalid("lead")),d(),x(e.isInvalid("lead")?11:12),d(5),c("invalid",e.isInvalid("value")),d(),x(e.isInvalid("value")?17:18),d(2),c("loading",e.loading())("disabled",e.loading()))},dependencies:[ke,Te,Fe,Ie,Ne,Ke,Qe,Ge,je,q,A,Re,He,Oe,K,Q,qe,Xe,De,W],encapsulation:2})};var $e=`
    .p-iconfield {
        position: relative;
        display: block;
    }

    .p-inputicon {
        position: absolute;
        top: 50%;
        margin-top: calc(-1 * (dt('icon.size') / 2));
        color: dt('iconfield.icon.color');
        line-height: 1;
        z-index: 1;
    }

    .p-iconfield .p-inputicon:first-child {
        inset-inline-start: dt('form.field.padding.x');
    }

    .p-iconfield .p-inputicon:last-child {
        inset-inline-end: dt('form.field.padding.x');
    }

    .p-iconfield .p-inputtext:not(:first-child),
    .p-iconfield .p-inputwrapper:not(:first-child) .p-inputtext {
        padding-inline-start: calc((dt('form.field.padding.x') * 2) + dt('icon.size'));
    }

    .p-iconfield .p-inputtext:not(:last-child) {
        padding-inline-end: calc((dt('form.field.padding.x') * 2) + dt('icon.size'));
    }

    .p-iconfield:has(.p-inputfield-sm) .p-inputicon {
        font-size: dt('form.field.sm.font.size');
        width: dt('form.field.sm.font.size');
        height: dt('form.field.sm.font.size');
        margin-top: calc(-1 * (dt('form.field.sm.font.size') / 2));
    }

    .p-iconfield:has(.p-inputfield-lg) .p-inputicon {
        font-size: dt('form.field.lg.font.size');
        width: dt('form.field.lg.font.size');
        height: dt('form.field.lg.font.size');
        margin-top: calc(-1 * (dt('form.field.lg.font.size') / 2));
    }
`;var gt=["*"],vt={root:({instance:t})=>["p-iconfield",{"p-iconfield-left":t.iconPosition=="left","p-iconfield-right":t.iconPosition=="right"}]},et=(()=>{class t extends G{name="iconfield";theme=$e;classes=vt;static \u0275fac=(()=>{let i;return function(a){return(i||(i=S(t)))(a||t)}})();static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})();var le=(()=>{class t extends X{iconPosition="left";styleClass;_componentStyle=h(et);static \u0275fac=(()=>{let i;return function(a){return(i||(i=S(t)))(a||t)}})();static \u0275cmp=m({type:t,selectors:[["p-iconfield"],["p-iconField"],["p-icon-field"]],hostVars:2,hostBindings:function(e,a){e&2&&j(a.cn(a.cx("root"),a.styleClass))},inputs:{iconPosition:"iconPosition",styleClass:"styleClass"},features:[H([et]),E],ngContentSelectors:gt,decls:1,vars:0,template:function(e,a){e&1&&(R(),V(0))},dependencies:[z],encapsulation:2,changeDetection:0})}return t})(),tt=(()=>{class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=P({type:t});static \u0275inj=k({imports:[le]})}return t})();var yt=["*"],_t={root:"p-inputicon"},it=(()=>{class t extends G{name="inputicon";classes=_t;static \u0275fac=(()=>{let i;return function(a){return(i||(i=S(t)))(a||t)}})();static \u0275prov=F({token:t,factory:t.\u0275fac})}return t})(),se=(()=>{class t extends X{styleClass;_componentStyle=h(it);static \u0275fac=(()=>{let i;return function(a){return(i||(i=S(t)))(a||t)}})();static \u0275cmp=m({type:t,selectors:[["p-inputicon"],["p-inputIcon"]],hostVars:2,hostBindings:function(e,a){e&2&&j(a.cn(a.cx("root"),a.styleClass))},inputs:{styleClass:"styleClass"},features:[H([it]),E],ngContentSelectors:yt,decls:1,vars:0,template:function(e,a){e&1&&(R(),V(0))},dependencies:[z,Y],encapsulation:2,changeDetection:0})}return t})(),nt=(()=>{class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=P({type:t});static \u0275inj=k({imports:[se,Y,Y]})}return t})();var at=["asc","desc","relevance"];var $=class t{searchQuery="";searchSort="relevance";sortOptions=at.map(n=>({label:n,value:n}));searchCriteriaChanged=f();emitSearchCriteria(){this.searchCriteriaChanged.emit({query:this.searchQuery,sort:this.searchSort})}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=m({type:t,selectors:[["app-search"]],outputs:{searchCriteriaChanged:"searchCriteriaChanged"},decls:6,vars:3,consts:[[1,"w-fit","flex","items-center","justify-center","flex-wrap","gap-2","md:gap-4"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","Search...","name","searchQuery",3,"ngModelChange","ngModel"],["name","searchSort","multiple","false",3,"ngModelChange","options","ngModel"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"p-icon-field"),u(2,"p-inputIcon",1),r(3,"input",2),oe("ngModelChange",function(l){return re(e.searchQuery,l)||(e.searchQuery=l),l}),s("ngModelChange",function(){return e.emitSearchCriteria()}),o()(),r(4,"p-icon-field")(5,"p-select-button",3),oe("ngModelChange",function(l){return re(e.searchSort,l)||(e.searchSort=l),l}),s("ngModelChange",function(){return e.emitSearchCriteria()}),o()()()),i&2&&(d(3),ae("ngModel",e.searchQuery),d(2),c("options",e.sortOptions),ae("ngModel",e.searchSort))},dependencies:[tt,le,nt,se,Je,We,Ye,q,A,Ve,K,Q],encapsulation:2})};var ee=class t{startX=null;startY=null;minHorizontalDistance=60;maxVerticalDeviation=35;disableSwipe=g(!1,{transform:O});swipedLeft=f();handlePointerDown(n){if(this.disableSwipe()){this.resetGesture();return}this.startX=n.clientX,this.startY=n.clientY}handlePointerUp(n){if(this.disableSwipe()||this.startX===null||this.startY===null){this.resetGesture();return}let i=n.clientX-this.startX;Math.abs(n.clientY-this.startY)<=this.maxVerticalDeviation&&i<=-this.minHorizontalDistance&&this.swipedLeft.emit(),this.resetGesture()}resetGesture(){this.startX=null,this.startY=null}static \u0275fac=function(i){return new(i||t)};static \u0275dir=B({type:t,selectors:[["","appSwipeLeft",""]],hostAttrs:[2,"touch-action","pan-y"],hostBindings:function(i,e){i&1&&s("pointerdown",function(l){return e.handlePointerDown(l)})("pointerup",function(l){return e.handlePointerUp(l)})("pointercancel",function(){return e.resetGesture()})("pointerleave",function(){return e.resetGesture()})},inputs:{disableSwipe:[1,"disableSwipe"]},outputs:{swipedLeft:"swipedLeft"}})};var te=class t{startX=null;startY=null;minHorizontalDistance=60;maxVerticalDeviation=35;disableSwipe=g(!1,{transform:O});swipedRight=f();handlePointerDown(n){if(this.disableSwipe()){this.resetGesture();return}this.startX=n.clientX,this.startY=n.clientY}handlePointerUp(n){if(this.disableSwipe()||this.startX===null||this.startY===null){this.resetGesture();return}let i=n.clientX-this.startX;Math.abs(n.clientY-this.startY)<=this.maxVerticalDeviation&&i>=this.minHorizontalDistance&&this.swipedRight.emit(),this.resetGesture()}resetGesture(){this.startX=null,this.startY=null}static \u0275fac=function(i){return new(i||t)};static \u0275dir=B({type:t,selectors:[["","appSwipeRight",""]],hostAttrs:[2,"touch-action","pan-y"],hostBindings:function(i,e){i&1&&s("pointerdown",function(l){return e.handlePointerDown(l)})("pointerup",function(l){return e.handlePointerUp(l)})("pointercancel",function(){return e.resetGesture()})("pointerleave",function(){return e.resetGesture()})},inputs:{disableSwipe:[1,"disableSwipe"]},outputs:{swipedRight:"swipedRight"}})};var wt=t=>["/leads",t],ie=class t{lead=g.required();leadUpdated=f();leadService=h(w);updateStageSubscription;deleteLeadSubscription;updateStage(n){if(!n)switch(this.lead().getStage()){case"new":n="contacted";break;case"contacted":n="proposal";break;case"proposal":n="closed";break;case"closed":n="closed";break}this.updateStageSubscription=this.leadService.updateLeadStage(this.lead().getId(),n).subscribe(()=>{this.leadUpdated.emit()})}deleteLead(){this.leadService.deleteLead(this.lead().getId()).subscribe(()=>{this.leadUpdated.emit()})}ngOnDestroy(){this.updateStageSubscription?.unsubscribe(),this.deleteLeadSubscription?.unsubscribe()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=m({type:t,selectors:[["app-lead-card"]],inputs:{lead:[1,"lead"]},outputs:{leadUpdated:"leadUpdated"},decls:25,vars:19,consts:[["appSwipeRight","","appSwipeLeft","","styleClass","group w-xs relative mb-7","tabindex","0",3,"swipedRight","swipedLeft"],[3,"leadId","leadTitle"],[1,"flex","justify-between","items-start","max-h-0","overflow-hidden","group-focus-within:max-h-40","group-hover:max-h-40","transition-all","duration-300","ease-in","mt-4"],[1,"w-3/5"],[1,"font-normal","text-sm","truncate"],[1,"font-light","text-sm","text-gray-500"],[1,"flex","flex-col","items-end","w-2/5"],[1,"mb-2"],[1,"pi","pi-wallet","text-primary"],[1,"pi","pi-file-edit","text-primary"],[1,"pi","pi-check-circle","text-primary"],[1,"text-end","text-xs","font-light","text-gray-500","block","max-h-10","group-hover:max-h-0","group-focus-within:max-h-0","overflow-hidden","transition-all","duration-300","ease-in-out"],[1,"flex","items-center","gap-2","absolute","group-focus-within:-bottom-6","right-0","-z-10","group-focus-within:z-10","text-sm","text-primary","hover:border-b","hover:border-primary","cursor-pointer","transition","duration-300","ease-in-out",3,"routerLink"],[1,"pi","pi-arrow-right"]],template:function(i,e){if(i&1&&(r(0,"p-card",0),s("swipedRight",function(){return e.updateStage()})("swipedLeft",function(){return e.deleteLead()}),u(1,"app-lead-title",1),r(2,"div",2)(3,"div",3)(4,"p",4),p(5),o(),r(6,"p",5),p(7),o()(),r(8,"div",6)(9,"span",7),p(10),de(11,"currency"),u(12,"i",8),o(),r(13,"span",7),p(14),u(15,"i",9),o(),r(16,"span",7),p(17),u(18,"i",10),o()()(),r(19,"p",11),p(20),de(21,"date"),o(),r(22,"a",12),p(23," Detailed View "),u(24,"i",13),o()()),i&2){let a,l,N,T;d(),c("leadId",e.lead().getId())("leadTitle",e.lead().getTitle()),d(4),b(" ",((a=e.lead().getContact())==null?null:a.getName())||"No Contact"," "),d(2),b(" ",((l=e.lead().getContact())==null?null:l.getEmail())||((l=e.lead().getContact())==null?null:l.getPhone())||"No Contact Info"," "),d(3),b(" ",Se(11,9,e.lead().getValue(),"INR","symbol","1.0-0")||"-"," "),d(4),b(" ",((N=e.lead().getNotes())==null?null:N.length)||0," "),d(3),b(" ",((T=e.lead().getTasks())==null?null:T.length)||0," "),d(3),b(" ",_e(21,14,e.lead().getCreatedAt(),"MMM dd, yyyy 'at' hh:mm a")," "),d(2),c("routerLink",ye(17,wt,e.lead().getId()))}},dependencies:[Ue,Ee,xe,te,ee,Ze,Le,Ce],encapsulation:2})};function Lt(t,n){if(t&1){let i=U();r(0,"app-lead-card",4),s("leadUpdated",function(){L(i);let a=D();return C(a.handleLeadUpdated())}),o()}if(t&2){let i=n.$implicit;c("lead",i)}}var ne=class t{kanbanType=g.required();leadUpdated=f();kanbanTitle=y(()=>{switch(this.kanbanType()){case"new":return{title:"New Leads",description:"Leads that have just been added.",severity:"success",icon:"pi pi-inbox"};case"contacted":return{title:"Contacted Leads",description:"Leads that have been contacted.",severity:"info",icon:"pi pi-comments"};case"proposal":return{title:"Proposal Leads",description:"Leads that have received a proposal.",severity:"error",icon:"pi pi-file-edit"};case"closed":return{title:"Closed Leads",description:"Leads that have been closed.",severity:"secondary",icon:"pi pi-check-circle"}}});leads=g.required();handleLeadUpdated(){this.leadUpdated.emit()}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=m({type:t,selectors:[["app-lead-kanban"]],inputs:{kanbanType:[1,"kanbanType"],leads:[1,"leads"]},outputs:{leadUpdated:"leadUpdated"},decls:6,vars:3,consts:[[1,"w-fit","px-2","min-w-[350px]"],["styleClass","mb-4",3,"icon","severity"],[1,"flex","flex-col","items-center"],[3,"lead"],[3,"leadUpdated","lead"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"p-message",1),p(2),o(),r(3,"div",2),me(4,Lt,1,1,"app-lead-card",3,ue),o()()),i&2&&(d(),c("icon",e.kanbanTitle().icon)("severity",e.kanbanTitle().severity),d(),be(e.kanbanTitle().title),d(2),fe(e.leads()))},dependencies:[ie,Ae,W],encapsulation:2})};var pe=class t{searchCriteria=_({query:"",sort:"relevance"});refresh=_(Symbol());leadService=h(w);leads=Be(Pe(this.refresh).pipe(ce(()=>this.leadService.getLeads(this.searchCriteria()))),{initialValue:[]});newLeads=y(()=>this.leads().filter(n=>n.getStage()==="new"));contactedLeads=y(()=>this.leads().filter(n=>n.getStage()==="contacted"));proposalLeads=y(()=>this.leads().filter(n=>n.getStage()==="proposal"));closedLeads=y(()=>this.leads().filter(n=>n.getStage()==="closed"));handleSearchCriteriaChanged(n){this.searchCriteria.set(n),this.refresh.set(Symbol())}handleCreatedNewLead(){this.refresh.set(Symbol())}handleUpdatedLead(){this.refresh.set(Symbol())}static \u0275fac=function(i){return new(i||t)};static \u0275cmp=m({type:t,selectors:[["app-leads"]],decls:9,vars:8,consts:[[1,"w-full","flex","justify-between","flex-wrap","items-center","gap-2","mb-5"],[3,"searchCriteriaChanged"],[3,"createdNewLead"],[1,"flex","justify-between","items-start","gap-2","overflow-x-scroll","2xl:overflow-x-auto","leads__kanban-container"],[3,"leadUpdated","kanbanType","leads"]],template:function(i,e){i&1&&(u(0,"router-outlet"),r(1,"div",0)(2,"app-search",1),s("searchCriteriaChanged",function(l){return e.handleSearchCriteriaChanged(l)}),o(),r(3,"app-new-lead",2),s("createdNewLead",function(){return e.handleCreatedNewLead()}),o()(),r(4,"div",3)(5,"app-lead-kanban",4),s("leadUpdated",function(){return e.handleUpdatedLead()}),o(),r(6,"app-lead-kanban",4),s("leadUpdated",function(){return e.handleUpdatedLead()}),o(),r(7,"app-lead-kanban",4),s("leadUpdated",function(){return e.handleUpdatedLead()}),o(),r(8,"app-lead-kanban",4),s("leadUpdated",function(){return e.handleUpdatedLead()}),o()()),i&2&&(d(5),c("kanbanType","new")("leads",e.newLeads()),d(),c("kanbanType","contacted")("leads",e.contactedLeads()),d(),c("kanbanType","proposal")("leads",e.proposalLeads()),d(),c("kanbanType","closed")("leads",e.closedLeads()))},dependencies:[$,J,ne,Me],styles:[".leads__kanban-container[_ngcontent-%COMP%]{overflow:auto;scrollbar-width:none;-ms-overflow-style:none}.leads__kanban-container[_ngcontent-%COMP%]::-webkit-scrollbar{width:0;height:0;display:none}"]})};export{pe as default};
